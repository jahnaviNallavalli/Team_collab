<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Upload Study Resources</title>
  
  <!-- Bootstrap CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body {
      background-color: #eef2f7;
      display: flex;
      height: 100vh;
      justify-content: center;
      align-items: center;
    }
    .upload-container {
      background-color: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 0 12px rgba(0,0,0,0.1);
      width: 100%;
      max-width: 500px;
    }
    .file-item {
      background-color: #f8f9fa;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 6px;
      border-left: 4px solid #007bff;
    }
  </style>
</head>
<body>

<div class="upload-container">
  <h2 class="text-center mb-4">Upload Study Resources</h2>

  <div class="mb-3">
    <label for="docName" class="form-label">Document Title</label>
    <input type="text" class="form-control" id="docName" placeholder="e.g. DBMS Notes" />
  </div>

  <div class="mb-3">
    <label for="docUpload" class="form-label">Choose Files (.doc, .docx, .pdf)</label>
    <input type="file" class="form-control" id="docUpload" accept=".doc,.docx,.pdf" multiple />
  </div>

  <div class="mb-3">
    <label for="description" class="form-label">Description / Notes</label>
    <textarea id="description" class="form-control" rows="3" placeholder="Optional: Description or details about the resource."></textarea>
  </div>

  <button class="btn btn-primary w-100" onclick="handleUpload()">Upload</button>

  <a href="uploaded.html" class="btn btn-outline-secondary mt-3 w-100">View Uploaded Files</a>

  <hr class="my-4">

  <h5>Uploaded Files</h5>
  <div class="file-list" id="fileList"></div>
</div>

<script>
  async function handleUpload() {
    const docName = document.getElementById('docName').value.trim();
    const files = document.getElementById('docUpload').files;
    const description = document.getElementById('description').value.trim();
    const fileList = document.getElementById('fileList');

    if (!docName || files.length === 0) {
      alert("Please enter a title and select at least one file.");
      return;
    }

    const formData = new FormData();
    formData.append('title', docName);
    formData.append('description', description);

    for (let file of files) {
      const ext = file.name.split('.').pop().toLowerCase();
      if (!['doc', 'docx', 'pdf'].includes(ext)) {
        alert(`Invalid file type: ${file.name}`);
        continue;
      }
      formData.append('files', file);
    }

    try {
      const response = await fetch('http://localhost:3000/upload', {
        method: 'POST',
        body: formData
      });

      const result = await response.json();

      if (response.ok) {
        loadUploadedFiles();  // Reload updated file list
        document.getElementById('docName').value = '';
        document.getElementById('docUpload').value = '';
        document.getElementById('description').value = '';
      } else {
        alert("Upload failed: " + result.message);
      }
    } catch (err) {
      console.error(err);
      alert("An error occurred while uploading.");
    }
  }

  async function loadUploadedFiles() {
    const fileList = document.getElementById('fileList');
    fileList.innerHTML = ''; // Clear existing list

    try {
      const response = await fetch('http://localhost:3000/files');
      const files = await response.json();

      if (Array.isArray(files)) {
        files.forEach(file => {
          const item = document.createElement('div');
          item.className = 'file-item';
          item.innerHTML = `
            <strong>Title:</strong> ${file.title}<br>
            <strong>File:</strong> <a href="http://localhost:3000/uploads/${file.filename}" target="_blank">${file.filename}</a><br>
            ${file.description ? `<strong>Notes:</strong> ${file.description}` : ''}
          `;
          fileList.appendChild(item);
        });
      }
    } catch (err) {
      console.error("Failed to load files:", err);
    }
  }

  // Load file list on page load
  loadUploadedFiles();
</script>

</body>
</html>
